extends layout

block content
  a(href='/') ← Back
  h1 Convert Markdown
  .card
    form#create-form
      label Upload ID
        input(name='uploadId', required, placeholder='paste uploadId')
      label Command
        input(name='command', placeholder='optional')
      button(type='submit') Create Job
      span#status
  .card
    h3 Jobs
    button#refresh-jobs Refresh
    table
      thead
        tr
          th Job ID
          script(src='/assets/convert-markdown.js')
      const body = { uploadId: fd.get('uploadId'), command: fd.get('command') || undefined };
      document.getElementById('status').textContent = 'Creating…';
      try {
        const res = await fetch('/api/convert-markdown/jobs', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(body) });
        if (!res.ok) throw new Error('Create failed');
        await res.json();
        document.getElementById('status').textContent = 'Created';
        await listJobs();
        await listMarkdowns();
      } catch (err) {
        document.getElementById('status').textContent = '';
        alert(err.message || 'Error creating job');
      }
    });
    listJobs();
    listMarkdowns();